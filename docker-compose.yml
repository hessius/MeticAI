# ==============================================================================
# MeticAI Docker Compose Configuration
# ==============================================================================
# Single unified container for all MeticAI services (v2.0).
#
# Usage:
#   docker compose up -d
#
# Optional add-ons:
#   docker compose -f docker-compose.yml -f docker-compose.tailscale.yml up -d
#   docker compose -f docker-compose.yml -f docker-compose.watchtower.yml up -d
# ==============================================================================

services:
  meticai:
    image: ghcr.io/hessius/meticai:latest
    container_name: meticai
    build:
      context: .
      dockerfile: docker/Dockerfile.unified
    restart: unless-stopped
    ports:
      - "3550:3550"   # Web UI (nginx proxy)
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - METICULOUS_IP=${METICULOUS_IP:-meticulous.local}
      - DATA_DIR=/data
    volumes:
      - meticai-data:/data
      - mosquitto-data:/var/lib/mosquitto
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:3550/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    stop_grace_period: 10s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 512M
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

volumes:
  meticai-data:
    name: meticai-data
  mosquitto-data:
    name: mosquitto-data
